# Data Integration with truemetrics  

By default, you have two ways to consume data from truemetrics:  
- **Batch Export** (commonly in Parquet format)  
- **Customer-Specific REST API**  

The **Batch Export** is the most widely used method, providing all your data as a Parquet file. Alternatively, the **Customer-Specific REST API** offers tailored solutions for specific use cases.  

This section focuses on the batch export. For more details about the REST API, visit the [API Reference](https://docu.truemetrics.cloud/api-reference/endpoint/parkingPlaces).  

---

## Data Overview  

Batch exports typically include two types of data:  
- **Stop KPI Data**: Detailed information about each stop/delivery.  
- **Location Data**: Recorded parking places and entrances.  

---

## Stop KPI Data  

Stop KPI data is exported in a **tabular format (Parquet)** and includes the following fields:  

| **Field**                           | **Type**             | **Description**                                                                 |
|-------------------------------------|----------------------|-------------------------------------------------------------------------------|
| *Delivery ID*                     | `STRING`             | Identifier provided by your metadata to simplify data warehouse integration.  |
| *Stop ID*                         | `STRING`             | Used for debugging and analysis purposes.                                     |
| *Stopping Time*                   | `FLOAT (UTC seconds)`| Total duration of the stop, measured in seconds, showing the actual stop time.|
| *H3 Index*                        | `STRING (H3 Level 10)`| Enables spatial aggregations for deeper insights into delivery areas.         |
| *Service Time*                    | `FLOAT (seconds)`    | Total time between leaving and returning to the vehicle.                      |
| *Outdoor Service Time to Customer*| `FLOAT (seconds)`    | Time from leaving the vehicle to entering the customer’s building.            |
| *Indoor Service Time*             | `FLOAT (seconds)`    | Time spent inside the customer’s building to complete the delivery.           |
| *Outdoor Service Time from Customer*| `FLOAT (seconds)`  | Time from leaving the customer’s building to re-entering the vehicle.         |
| *Picking Time*                    | `FLOAT (seconds)`    | Time from parking to leaving the vehicle to approach the delivery location.   |
| *Buffer Time*                     | `FLOAT (seconds)`    | Time spent at the parking location before leaving for the next delivery.      |
| *Search Time*                     | `FLOAT (seconds)`    | Estimated time to locate the correct entrance or delivery location.           |

### Search Time Notes  
The **Search Time** is calculated as the difference between the time taken to approach the entrance and return to the vehicle. This metric is an estimate and may be influenced by factors such as waiting at doors or handling heavy deliveries.  
> **Note**: Search Time is only available for deliveries conducted indoors.  

<img height="240" noZoom src="/images/stopskpis.png" />

### Custom Fields  
truemetrics enhances your data with **custom fields** based on your metadata (e.g., tour ID, job type, driver, or vehicle type), enabling flexible filtering and analysis.  

---

### Example Row: Stop KPI Data  
The following is an example of a typical row in the Parquet file:  

```json
{
  "t_utc_created": 1730508307.309725,
  "id_stop": "38035d61a2567dc161c039a47b286fdc61c49d75f49dceade5e010aafcbd09a0",
  "ids_delivery_external": ["XXXXDHDHDH"],
  "id_driver": "YXXDDX12",
  "type_vehicle": "unknown",
  "t_picking": 3.08,
  "t_stopping": 49.33, 
  "t_buffer": 3.08,
  "t_indoor": 0,
  "t_outdoor_from_customer": -21.58,
  "t_outdoor_to_customer": -21.58,
  "t_search": 0,
  "h3_10": "8a20e60a0c67fff"
}
```
## Location Data  

Location data includes recorded entrances and parking places and is typically stored as **GeoParquet** files.  

| **Field**              | **Type**            | **Description**                                                                 |
|-------------------------|---------------------|-------------------------------------------------------------------------------|
| **Address**             | `STRING (multiple)` | The primary key can be an address ID or actual address string, depending on the metadata provided. Entrances across deliveries are aggregated for improved accuracy. |
| **Position ID**         | `STRING`           | Internal identifier for the position. While unique, it may change, so avoid using it for filtering. |
| **Geometry**            | `GEOOBJECT`        | Latitude and longitude coordinates stored as geometry columns ([GeoParquet](https://geoparquet.org/releases/v1.0.0/)). |
| **Position Type**       | `STRING`           | Specifies whether the position is a **parking spot** or an **entrance**.       |
| **Timestamp**           | `FLOAT (UTC seconds)` | Time when the position was recorded.                                           |
| **Accuracy**            | `FLOAT (meters)`   | Estimated accuracy of the recorded position. Accuracy improves with multiple detections for entrances. Parking place accuracy may vary. |
| **Custom Fields**       | `STRING`           | Additional metadata provided (e.g., tour ID, job type, driver, or vehicle type) for tailored analysis. |

---

### Example Row: Location Data  

The following is an example of a typical row in the GeoParquet file:  

```json
{
  "h3_10": "8a1f1884544ffff",
  "id_address": "f30ae15b1b5ba0e04093d841fc81a48b27e55cecdff905a3c36c94d65489921c",
  "postalcode": "test",
  "countrycode": "DE",
  "street": "teststreet", 
  "street_number": "7a", 
  "type_position": "parkingplace", 
  "metadata_from_customer": "test",
  "t_utc_created": 1731144069.383282,
  "id_position": "6f8bded37a7b35a7f51e0fc8019462388704b2b6097c7e5636d266d54e18566a",
  "accuracy": 9.648,
  "number_detections": 1,
  "geometry": {
    "0": 1, "1": 1, "2": 0, "3": 0, "4": 0, "5": 14, "6": 16,
    "7": 204, "8": 209, "9": 227, "10": 93, "11": 42, "12": 64,
    "13": 214, "14": 173
  }
}
```

## Architecture

To receive your Parquet export, contact truemetrics to arrange a delivery method that suits your infrastructure. Available options include shared S3 buckets, pre-signed URLs, or Dropbox folders.

